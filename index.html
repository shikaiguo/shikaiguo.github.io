<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="/lib/css/normalize.min.css" rel="stylesheet">
    <style for="common">
        .material-icons{
            line-height: inherit;
            font-size: inherit;
            color: inherit;
        }
        .left{
            float: left;
        }
        .right{
            float: right;
        }
        body{
            font-family: "consolas";
        }
        header{
            width: 100%;
        }
        header div.logo{
            width: 16rem;
            margin: 0 auto;
        }
        header div.logo img{
        }
        header div.tag{
            width: 100%;
            height: 8rem;
            line-height: 8rem;
            text-align: center;
        }
        header div.tag label{
            font-size: 1.5rem;
            color: #f11;
        }
        header div.line{
            width: 100%;
            border-bottom: 1px solid #ddd;
        }
        header div.back-top{
            display: none;
            position: fixed;
            right: 2rem;
            bottom: 2rem;
            width: 3rem;
            height: 3rem;
            line-height: 3rem;
            background-color: rgba(0,0,0,.3);
            color: rgba(0,0,0,.8);
            text-align: center;
            border-radius: .5rem;
            font-size: 2rem;
            cursor: pointer;
            border: 1px solid rgba(0,0,0,0);
            transition: background-color .2s,color .2s, border .2s, font-size .2s;
            transition-timing-function: ease-out;
        }
        header div.back-top:hover{
            background-color: #01579b;
            /*width: calc(3rem - 2px);*/
            /*height: calc(3rem - 2px);*/
            border: 1px solid #ddd;
            font-size: 2.5rem;
            color: #fff;
        }
        nav{
            height: 3rem;
            color: #fff;
            background-color: #01579b;
            transition: box-shadow .3s;
        }
        nav.nav-pin{
            position: fixed;
            top: -1px;
            width: 100%;
            box-shadow: 0 3px 3px #999;
        }
        .blank.nav-pin{
            height: 3rem;
        }
        nav ul{
            margin: 0 auto;
            min-width: 32rem;
            max-width: 56rem;
            height: inherit;
            list-style: none;
            padding-left: 0;
        }
        nav ul li{
            float: left;
            text-align: center;
        }
        nav ul li a{
            width: 8rem;
            display: inline-block;
            color: #fff;
            text-decoration: none;
            line-height: 3rem;
            font-size: 1rem;
            transition: background-color .3s;
        }
        nav ul li a:hover{
            background-color: #0288d1;
        }
        footer{
            border-top: 1px solid #ddd;
            max-width: 56rem;
            margin: 0 auto;
            height: 2.5rem;
            line-height: 2.5rem;
            font-family: "consolas";
        }
        footer a{
            text-decoration: none;
            color: #000;
            transition: color .2s;
        }
        footer a:hover{
            color: #999;
            text-decoration: underline;
        }
    </style>
    <style for="index">
        div.article-list{
            margin: 0 auto;
            min-width: 32rem;
            max-width: 56rem;
        }
        div.article-list ul{
            list-style: none;
            padding-left: 0;
        }
        div.article-list ul li{
            border: 1px solid #ccc;
            box-shadow: .12rem .25rem .25rem #ddd;
            word-wrap: break-word;
            margin-top:1rem;
            margin-bottom:1rem;
            padding: .7rem;
            overflow: hidden;
        }
        div.article-list ul li div.title{
            padding-bottom: .7rem;
            border-bottom: 1px dashed #bbb;
            line-height: 1rem;
            height: 1rem;
        }
        div.article-list ul li div.title a{
            color: #666;
            text-decoration: none;
        }
        div.article-list ul li div.title label{
            color: #999;
            float: right;
            font-size: .8rem;
            line-height: 1rem;
        }
        div.article-list ul li div.remark{
            padding-top: .7rem;
            padding-bottom: .7rem;
        }
        div.article-list ul li div.bottom{
            color: #aaa;
            float: right;
        }
        div.article-list ul li div.bottom a{
            color: #333;
            font-size: .8rem;
            text-decoration: none;
        }
        div.article-list ul li div.bottom a:hover{
            text-decoration: underline;
        }
        div.article-list .loading{
            text-align: center;
            height: 2rem;
            display: none;
            /*line-height: 2rem;*/
        }
        div.article-list .tail{
            text-align: center;
            height: 2rem;
            display: none;
            /*line-height: 2rem;*/
        }
    </style>
</head>
<body>
    <div class="container">
        <header role="banner">
            <div class="logo">
                <img src="/images/logo.png">
            </div>
            <div class="tag">
                <label>HELLO&emsp;WORLD</label>
            </div>
            <div class="back-top">
                <i class="material-icons">keyboard_arrow_up</i>
            </div>
        </header>
        <nav role="menu">
            <ul>
                <li>
                    <a href="/">IO</a>
                </li>
            </ul>
        </nav>
        <div class="blank"></div>
        <div class="article-list">
            <ul></ul>
            <script type="text/html" id="articleListItemTpl">
                {@each list as row}
                    <li>
                        <div class="title">
                            <a href="/article?id=${row.id}">${row.title}</a>
                            <label>${row.date}</label>
                        </div>
                        <div class="remark">${row.remark}</div>
                        <div class="bottom">
                            &gt;<a href="/article?id=${row.id}">more</a>
                        </div>
                    </li>
                {@/each}
            </script>
            <div class="loading">-- loading --</div>
            <div class="tail">-- no more. --</div>
        </div>
        <footer>
            <div class="copy left"><a href="http://guoshikai.com">guoshikai.com</a> &copy; 2016</div>
            <div class="right">
                <a href="https://github.com/shikaiguo">Github</a>
            </div>
        </footer>
    </div>
    <script src="/lib/js/jquery-3.1.1.min.js"></script>
    <script src="/lib/juicer/juicer-min.js"></script>
<script>
</script>
<script>
    $(function(){
        $(document).scroll(scrollListener);
        scrollListener();
        $(".back-top").click(function(){
            $("body").animate({ scrollTop: 0 }, 200);
        });
    });
</script>
<script>
    var navHeight = false;
    var navStatus = false;
    function scrollListener(){
        var documentScrollTop = $(document).scrollTop();
        /* nav */
        navHeight = navHeight || $("nav").offset().top - 1;
        var f = documentScrollTop > navHeight;
        if(f !== navStatus){
            navStatus = f;
            $("nav,.blank").toggleClass("nav-pin");
            $(".back-top").fadeToggle(200);
        }
        /* get article list*/
        if (documentScrollTop + $(window).height() >= $(document).height() - 233) {
            getArticleList();
        }
    }
    var page  = 0;
    var total = 1;
    var limit = 10; //max: 25
    function getArticleList(){
        $.ajax({
            url: "http://api.guoshikai.com/io/getArticleList",
            type: "post",
            data: {
                page: page + 1
            },
            beforeSend: function(){
                if(page >= total || "block" === $(".loading").css("display")){
                    return false;
                }
                $(".loading").fadeIn();
            },
            success: function(r){
                $(".loading").hide();
                if(0 !== r.code){
                    return false;
                }
                var tpl = $("#articleListItemTpl").text();
                var html = juicer(tpl, r.data);
                $(".article-list>ul").append(html);
                page = parseInt(r.data.page);
                total = parseInt(r.data.total);
                if(page === total) {
                    $(".tail").fadeIn();
                }
            }
        });
    }
</script>
</body>
</html>
